<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
	<title>freecycle</title>
	<style>
		.card .card-image,
			.card .card-image .image img {
			height: 200px;
			width:50px;
			}
	</style>
	<script src="https://unpkg.com/vue@next"></script> <!-- https://v3.vuejs.org/guide/installation.html#cdn -->
	<!-- <script src="vue.js"></script> -->
</head>
<body>
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="navbar-item">
				FreeCycle
			  </a>
		  </a>
	  
		  <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
			<span aria-hidden="true"></span>
			<span aria-hidden="true"></span>
			<span aria-hidden="true"></span>
		  </a>
		</div>
	  </nav>
	<h1>freecycle</h1>
	<div id="app">
		<form @submit.prevent="create_item" data-action="user_id">
			<input name="user_id" v-model="item.user_id" placeholder="user_id">
			<input name="keywords" v-model="item.keywords" placeholder="keywords">
			<input name="description" v-model="item.description" placeholder="description">
			<input name="image" v-model="item.image" placeholder="image">
			<input name="lat" v-model="item.lat" placeholder="lat">
			<input name="lon" v-model="item.lon" placeholder="lon">
			<button data-action="create_item">submit</button>
		</form>
		<div>
			<h1>Items</h1>
		</div>
        <ul>
            <li v-for="item in items">
              <span data-field="id">{{item.id}}</span>
              <span>{{item.user_id}}</span>
              <span>{{item.keywords}}</span>
              <span>{{item.description}}</span>
              <span>{{item.image}}</span>
              <span>{{item.lat}}</span>
              <span>{{item.lon}}</span>
              <span>{{item.date_from}}</span>
              <span>{{item.date_to}}</span>
              <button @click="deleteItem(item.id)" data-action="delete">Delete</button>
            </li>
          </ul>
		<!---https://stackoverflow.com/questions/48303637/bulma-why-all-columns-are-on-one-line --->
	</div>
<script type="module">

	const { createApp } = Vue
	const DEFAULT_API = '/api/v1';
	const urlParams = new URLSearchParams(window.location.search);
	const urlAPI = (urlParams.get('api') || DEFAULT_API).replace(/\/$/, '');

createApp({
    data() {
		return {
			urlAPI,
			item: {
                id: '',
                user_id: '',
                keywords: '',
                description: '',
                image: '',
                lat: '',
                lon: '',
                date_from: '',
                date_to:'',
			},
			items:[]
		}
	},
	  created() {
		this.clearInput()
		this.getItem()
	  },
	  methods: {
		getItem() {
			fetch(`${urlAPI}/items`, {
				method:'GET'
			})
				.then(response => response.json())
				.then(json => this.items = json)
			.catch(err => console.error(err))
		},
		clearInput() {
           this.item = {...this.item, ...{
                user_id: '',
                keywords: '',
                description: '',
                image: '',
                lat: '',
                lon: '',
            }}
		},
		create_item() {
			fetch(`${urlAPI}/item`, {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify(this.item),
			})
				.then(response => response.json())
				.then(()=>this.clearInput())
				.then(()=>this.getItem())
			.catch(err => console.error(err));
		},
        deleteItem(id){
            fetch(`${urlAPI}/item/${id}`, {
                method: 'DELETE',
            })
            .then(()=>this.getItem())
        .catch(err => console.error(err));
        }
    }
    }).mount('#app')

</script>

</body>
</html>



